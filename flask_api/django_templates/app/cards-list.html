{% extends "app/logged-base.html" %}

{% block content %}
<!-- Content Row -->
<div class="row">

  {% if not edit %}
  <!-- Add Card -->
  <div class="col-2">
    <div class="card border-left-success shadow mb-4" onclick="location.href='/edit/deck_{{deck.id}}/new_card'">
      <div class="card-body text-center">
        <h3>Add Card</h3>
      </div>
    </div>
  </div>
  <!-- import Card -->
  <div class="col-2">
    <div class="card border-left-warning shadow mb-4">
      <div class="card-body text-center">
        <h3>Import Cards</h3>
      </div>
    </div>
  </div>
  {% endif %}
   <!-- Search box -->
   <div class="col-8">
    <div class="card border-left-primary shadow mb-4">
      <div class="card-body text-center">
        <h3>Future Search&Filter Box</h3>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Add Card -->
  {% if edit and not card_to_edit %}
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-xs-12">
    <div class="card border-bottom-primary shadow mb-4">
      <form action="/edit/deck_{{deck.id}}/new_card" method="POST">
        {% csrf_token %}

        <div class="card-body">
          <div class="form-row align-baseline">
            <div class="form-group col-12">
              Question:
              {% include "app/renderers/selector.html" with name="question" renderers=renderers %}
              <hr>
            </div>
            <div class="form-group col-12">
              Answer:
              {% include "app/renderers/selector.html" with name="answer" renderers=renderers %}
              <hr>
            </div>
            <div class="form-group col-12">
              <select id="tags" name="tags" class="form-control custom-select" multiple>
                {% for tag in tags %}
                <option>{{tag}}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <div class="d-flex flex-row align-items-center justify-content-between">
            <a href="/edit/deck_{{deck.id}}/cards" class="btn btn-warning" style="margin-right:1em;">
              <i class="fas fa-fw fa-undo"></i>
              Cancel
            </a>
            <button type="submit" class="btn btn-success" style="margin-right:1em;">
              <i class="fas fa-fw fa-check"></i>
              Save
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
  {% endif %}


  <!-- Card Block -->
  {% for card in cards %}
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-xs-12">

    {% if card_to_edit == card %}

    <div class="card border-bottom-primary shadow mb-4">
      <form action="/edit/deck_{{deck.id}}/card_{{card.id}}" method="POST">
        {% csrf_token %}

        <div class="card-body">
          <div class="form-row align-baseline">
            <div class="form-group col-12">
              Question:
              {% include "app/renderers/selector.html" with name="question" value=card.question.fact renderers=renderers %}
            </div>
            <div class="form-group col-12">
              Answer:
              {% include "app/renderers/selector.html" with name="answer" value=card.answer.fact renderers=renderers %}
            </div>
            <div class="form-group col-12">
              <select id="tags" name="tags" class="form-control custom-select" multiple>
                {% for tag in tags %}
                <option>{{tag}}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <div class="d-flex flex-row align-items-center justify-content-between">
            <a href="/edit/deck_{{deck.id}}/cards" class="btn btn-warning" style="margin-right:1em;">
              <i class="fas fa-fw fa-undo"></i>
              Cancel
            </a>
            <button type="submit" class="btn btn-success" style="margin-right:1em;">
              <i class="fas fa-fw fa-check"></i>
              Save
            </button>
          </div>
        </div>

      </form>
    </div>

    {% else %}
    <div class="card border-bottom-{% if edit %}secondary{% else %}primary{% endif%} shadow mb-4 bg-gradient-{% if edit %}secondary{% else %}primary{% endif%}" 
      style="flex-direction:row;">
      <div class="card-body text-center" style="width:3em;max-width:3em;min-width:3em;padding:1rem;line-height:2rem;">
        <a href="{% if edit %}#{% else %}/edit/deck_{{deck.id}}/card_{{card.id}}{% endif%}" style="color:#fff;">
          <i class="fas fa-fw fa-pen"></i>
        </a>
        <a href="{% if edit %}#"{% else %}/edit/deck_{{deck.id}}/card_{{card.id}}/delete" onclick="return confirm('Are you sure you want to delete this card?')"{%endif%} style="color:#fff;">
          <i class="fas fa-fw fa-trash"></i>
        </a>
      </div>
  
      <div class="card" style="width:100%;">
        <!-- Card Body -->
        <div class="card-body text-center">
          <div class="row justify-content-center" >
            <div class="col-12 text-center">
              {% include "app/renderers/display/"|add:card.question.renderer.path with content=card.question.fact %}
            </div>
            <div class="col-12 text-center">
              {% include "app/renderers/display/"|add:card.answer.renderer.path with content=card.answer.fact %}
            </div>
          </div>
        </div>
        <div class="card-footer">
          Last Review: {{card.last_review.review_time}}
          {% for label, info in card.extra_info.items %}
          <br>
          {{label}}: {{info}}
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  {% endfor %}

</div>
{% endblock %}
